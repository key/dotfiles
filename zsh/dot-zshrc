# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

bindkey -e

# M-f/M-bの挙動をEmacsのそれに合わせる（実はM-bは元々同じだけど一応）
bindkey "^[f" emacs-forward-word
bindkey "^[b" emacs-backward-word

# M-f/M-b/M-dなどでの単語境界の基準をEmacsライクに
export WORDCHARS=""

setopt auto_cd
setopt nobeep

# history settings
HISTFILE=$HOME/.zsh-history
HISTSIZE=100000
SAVEHIST=100000

setopt extended_history
setopt hist_ignore_dups
setopt PROMPT_SUBST
setopt share_history
unsetopt promptcr

autoload history-search-end
autoload -U colors; colors
autoload -Uz vcs_info
zstyle ':vcs_info:*' formats ':(%s)%b'
zstyle ':vcs_info:*' actionformats ':(%s)%b|%a'
precmd () {
    psvar=()
    LANG=en_US.UTF-8 vcs_info
    [[ -n "$vcs_info_msg_0_" ]] && psvar[1]="$vcs_info_msg_0_"
}

export PATH=${HOME}/local/bin:/usr/local/bin:/usr/bin:/bin:/usr/X11R6/bin:/usr/local/sbin:/usr/sbin:/sbin
export MANPATH=${HOME}/local/man:/usr/local/man:/usr/X11R6/man:/usr/share/man
export LANG=ja_JP.UTF-8
export EDITOR=vi
export RSYNC_SSH=ssh

alias rgrep="grep -r"
alias less="less -R"
alias ll="ls -l"
alias la="ls -a"
alias rm="rm -i"
alias cp="cp -i"
alias mv="mv -i"
if [ -f /usr/bin/vim ]; then
    alias vi=vim
fi

# zsh
if [ ! -d $HOME/.zsh.d/ ]; then
    echo "can't find ~/.zsh.d/! so create that"
    mkdir $HOME/.zsh.d/
    fpath=(~/.zsh.d/ $fpath)
fi
if [ -d /usr/local/share/zsh/site-functions ]; then
    chmod 755 /usr/local/share/zsh /usr/local/share/zsh/site-functions
    fpath=(/usr/local/share/zsh/site-functions $fpath)
fi

##
## PATH setting
##

# PostgreSQL
if [ -d /usr/local/pgsql/bin ]; then
    export PATH=/usr/local/pgsql/bin:$PATH
    export MANPATAH=/usr/local/pgsql/man:$MANPATH
fi

# python
export WORKON_HOME=${HOME}/Documents/virtualenv
export PIP_DOWNLOAD_CACHE=~/.pip_cache
export PIP_RESPECT_VIRTUALENV=true
export PIPENV_VENV_IN_PROJECT=yes

if [ -f ${HOME}/.pythonrc.py ]; then
    export PYTHONSTARTUP=${HOME}/.pythonrc.py
fi

# anyenv
if [ -d $HOME/.anyenv ] ; then
    export PATH="$HOME/.anyenv/bin:$PATH"
    eval "$(anyenv init - zsh)"
    fpath=($HOME/.anyenv/completions/ $fpath)
fi

# pyenv
if [ -f /usr/local/bin/pyenv ]; then
    export PYENV_ROOT=${HOME}/.pyenv
    export PATH=${PYENV_ROOT}/bin:$PATH
    eval "$(pyenv init -)"
    eval "$(pyenv virtualenv-init -)"
fi

# rbenv
if [ -f /usr/local/bin/rbenv ]; then
    export RBENV_ROOT=${HOME}/.rbenv
    export PATH=${RBENV_ROOT}/bin:$PATH
    eval "$(rbenv init -)"
fi

# goenv
if [ -f /usr/local/bin/goenv ]; then
    export GOPATH=$HOME/go
    export PATH=$PATH:$GOROOT/bin:$GOPATH/bin
    eval "$(goenv init -)"
fi

# direnv
if [ -f /usr/local/bin/direnv ]; then
    eval "$(direnv hook zsh)"
fi

# fastlane
if [ -d ~/.fastlane ]; then
    export PATH="$HOME/.fastlane/bin:$PATH"
fi

# aws cli v1
if [ -d /usr/local/opt/awscli@1/bin ]; then
    alias awsv1=/usr/local/opt/awscli@1/bin/aws
fi

autoload -U compinit; compinit

# plugin
plugins=(virtualenv)

# powerlevel10k
source /usr/local/opt/powerlevel10k/powerlevel10k.zsh-theme
POWERLEVEL10K_RIGHT_PROMPT_ELEMENTS=(status virtualenv)

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
